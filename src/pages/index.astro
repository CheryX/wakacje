---
import Layout from '../layouts/Layout.astro';
import Until from '../components/DaysUntil.astro';
import settings from '../settings'

function formatDate(date) {
		const monthsInRomanNumerals = [
			"", "I", "II", "III", "IV", "V", "VI", "VII", "VIII", "IX", "X", "XI", "XII"
		];
		
		const day = date.getDate().toString().padStart(2, "0");
		const monthInRomanNumerals = monthsInRomanNumerals[date.getMonth() + 1];
		
		return `${day} ${monthInRomanNumerals}`;
	}

---

<Layout title="Ile do wakacji">
	<main class="flex flex-col mt-8 align-middle justify-center">

		<h1 class="text-4xl text-center font-bold">Ile do końca roku szkolnego</h1>

		<div class="flex justify-center py-4">

			<div class="px-20 py-10 text-center">
				<span class="text-2xl font-bold">
					<span id="h0">0</span> dnia
				</span> <br />
				do końca roku szkolnego
			</div>

			<div class="px-20 py-10 text-center">
				<span class="text-2xl font-bold">
					<Until id="h1" days={[1, 2, 3, 4, 5]} to={new Date(settings.endYear)} /> dni r.
				</span> <br />
				do końca roku szkolnego
			</div>

			<div class="px-20 py-10 text-center">
				<span class="text-2xl font-bold">
					<Until id="h2" days={[1, 2, 3, 4, 5]} to={new Date(settings.symEndYear)} /> dni r.
				</span> <br />
				do wystawienia ocen
			</div>

		</div>

		<table class="mx-auto text-lg">

			<thead>
				<tr>
					<th>Przedmiot</th>
					<th>{formatDate(new Date(settings.symEndYear))}</th>
					<th>{formatDate(new Date(settings.endYear))}</th>
				</tr>
			</thead>

			<tbody>
				{settings.subjects.map((data) => (
					<tr>
						<td>{data.name}</td>
						<td> <Until id={"o_"+data.name} days={data.occurences} to={new Date(settings.symEndYear)} /> </td>
						<td> <Until id={"k_"+data.name} days={data.occurences} to={new Date(settings.endYear)} /> </td>
					</tr>
				) )}
			</tbody>
		</table>

	</main>
</Layout>

<script>
	function daysUntilDate(targetDate) {
		const oneDayInMilliseconds = 1000 * 60 * 60 * 24;
		const currentDate = new Date();
		const timeDiffInMilliseconds = targetDate.getTime() - currentDate.getTime();
		const daysUntil = timeDiffInMilliseconds / oneDayInMilliseconds;
		return daysUntil.toFixed(7);
	}

	const h0 = document.getElementById("h0");
	
	h0.innerText = daysUntilDate( new Date("2023-06-22"));
	setInterval(e => {
		h0.innerText = daysUntilDate( new Date("2023-06-22") );
	}, 10)

</script>

<style>

	tbody > tr {
		@apply even:bg-slate-50;
	}

	tbody > tr > td {
		@apply px-10 py-1
	}

</style>